<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Climate Change Information Visualization</title>

  <link href="css/bootstrap.min.css" rel="stylesheet">
  <link href="css/radar-chart.min.css" rel="stylesheet">
  <link href="css/main.css" rel="stylesheet">
  <script src="js/d3.min.js" charset="utf-8"></script>
  <script src="js/radar-chart.min.js" charset="utf-8"></script>

  <link href="https://fonts.googleapis.com/css?family=Work+Sans:400,500" rel="stylesheet">

  <style>
  .areaNear{
    fill: #AEFF55;
    opacity: 0.5;
  }
  .areaFar{
    fill: #1EEEE0;
    opacity: 0.5;
  }

  .y path.domain {
    display: none;
  }

  .y .tick line {
    opacity: 0.1;
  }
  </style>
</head>

<body>
	<div class="container">
		<h1>next to this cities are growing more and moreâ€¦</h1>
		<h2>In everage cities are growing about X% every year. This will lead us to huge mega cities with lots of people and buildings.</h2>

		<div id="heat-productivity"></div>
    <button id="antwerp" class="btn btn-default">Antwerp</button><button id="bilbao" class="btn btn-default">Bilbao</button><button id="london" class="btn btn-default">London</button>
    <button id="nearButton" class="btn btn-warning">Near Warm Future</button><button id="farButton" class="btn btn-warning">Far Warm Future</button>
	</div>

  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <!--<script src="js/bootstrap.min.js"></script>-->
	<script>
  var margin = {top: 20, right: 20, bottom: 30, left: 60},
      width = 960 - margin.left - margin.right,
      height = 300 - margin.top - margin.bottom;

  var svg = d3.select('#heat-productivity').append('svg')
      .attr('width', width + margin.left + margin.right)
      .attr('height', height + margin.top + margin.bottom)
      .append("g")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

  var xScale = d3.scale.ordinal()
                .rangeRoundBands([0, width], 0.1); //this creates rounded pixel values and includes a 10% (0.1) margin between the bars

  var yScale = d3.scale.linear()
                .range([height, 0]);

  var xAxis = d3.svg.axis()
              .scale(xScale)
              .orient("top")
              .innerTickSize(0)
              .outerTickSize(0)
              .tickFormat("");

  var yAxis = d3.svg.axis()
              .scale(yScale)
              .orient("left")
              .innerTickSize(-width)
              .tickFormat(d3.format(","))
              .ticks(10);

  d3.json("data/adverted_losses.json", function(data) {
    console.log(data)

    var selectedCityData = data.totalLondon;
    var selectedFuture = 0;
    var selectedFutureArray = ["nearWarmFuture", "farWarmFuture"];

    xScale.domain( data.categoryNames );
    yScale.domain( [d3.max(selectedCityData.farWarmFuture, function (d){ return +d; }), 0] );

    //console.log(d3.extent(selectedCityData.nearWarmFuture, function (d){ return +d; }));

    svg.append("g")
        .attr("class", "x axis")
        .call(xAxis);

    svg.append("g")
        .attr("class", "y axis")
        .call(yAxis);

    // area chart
    var area = d3.svg.area()
        .interpolate("basis")
        .x(function(d, i) { return xScale(data.categoryNames[i]); })
        .y1(function(d) { return yScale(d); });

    svg.append("path")
          .datum(selectedCityData.nearWarmFuture)
          .attr("class", "areaNear")
          .attr("d", area);

    svg.append("path")
          .datum(selectedCityData.farWarmFuture)
          .attr("class", "areaFar")
          .attr("d", area);

    svg.append("line")
          .attr("class", "referenceLine")
          .attr("x1", 0)
          .attr("y1", function() { return yScale(selectedCityData.farWarmLoss); })
          .attr("x2", width)
          .attr("y2", function() { return yScale(selectedCityData.farWarmLoss); })
          .attr("stroke-width", 2)
          .attr("stroke", "red");

    // bar chart
    /*svg.append("g").selectAll(".bar")
          .data(selectedCityData.nearWarmFuture)
          .enter()
          .append("rect")
            .attr("class", "bar")
            .attr("x", function(d, i) { console.log(data.categoryNames[i]); return xScale(data.categoryNames[i]); })
            .attr("y", "0")
            .attr("height", function(d) { return yScale(d); })
            .attr("width", xScale.rangeBand());*/

    function updateChart(data) {

      // Scale the range of the data again
      xScale.domain( data.categoryNames );
      yScale.domain( [d3.max(selectedCityData.farWarmFuture, function (d){ return +d; }), 0] );

      // Select the section we want to apply our changes to
      var svg = d3.select("body").transition();

      svg.selectAll(".referenceLine")   // change the line
            .duration(750)
            .attr("y1", function() { return yScale(selectedCityData.nearWarmLoss); })
            .attr("y2", function() { return yScale(selectedCityData.nearWarmLoss); });
      /*svg.selectAll(".areaNear")
            .duration(750)
            .datum(selectedCityData.farWarmFuture)
            .attr("d", area);*/
      svg.select(".x.axis") // change the x axis
          .duration(750)
          .call(xAxis);
      svg.select(".y.axis") // change the y axis
          .duration(750)
          .call(yAxis);
    }

    d3.select("#nearButton").on("click", function(){
            updateChart(data);
    });

    d3.select("#antwerp").on("click", function(){
          selectedCityData = data.totalAntwerp;
          updateChart(data);
    });

    d3.select("#bilbao").on("click", function(){
          selectedCityData = data.totalBilbao;
          updateChart(data);
    });

    d3.select("#london").on("click", function(){
          selectedCityData = data.totalLondon;
          updateChart(data);
    });
  });
  </script>
</body>
</html>
